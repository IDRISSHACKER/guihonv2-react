version: 2.1

orbs:
  python: circleci/python@3.10.0

jobs:
  init:
    name: "etc"
    description: Call API V2 to deploy content to Docs Platform
    steps:
      - run:
        name: Install Dependencies
        command: |
          sudo apt update
          apt install python
          pip install ansible

  setup:
    name: "etc"
    description: Call API V2 to deploy content to Docs Platform
    steps:
    - run:
      name: Config ENV
      command: |
        ansible-playbook ./infrastructure/init.yml

  test:
    name: "etc"
    description: Call API V2 to deploy content to Docs Platform
    steps:
    - run:
      name: Run Test Unit
      command: |
        ansible-playbook ./infrastructure/test.yml

  builder:
    name: "etc"
    description: Call API V2 to deploy content to Docs Platform
    steps:
    - run:
      name: Building Artefact
      command: |
        ansible-playbook ./infrastructure/build.yml

  deployer:
    name: "etc"
    description: Call API V2 to deploy content to Docs Platform
    steps:
    - run:
      name: Deploy Artefact
      command: |
        ansible-playbook ./infrastructure/deploy.yml

  infra:
    name: "etc"
    description: Call API V2 to deploy content to Docs Platform
    steps:
    - run:
      name: Settings network
      command: |
        ansible-playbook ./infrastructure/network.yml

workflows:
  ci-ci-guihon-front:
    jobs:
      - init
      - setup
      - test
      - builder
      - deployer
      - infra
