version: 2.1

orbs:
  python: circleci/python@3.10.0

jobs:
  Init:
    steps:
      - run:
        name: Install Dependencies
        command: |
          sudo apt update
          apt install python
          pip install ansible

  Setup:
    steps:
      - run:
        name: Config ENV
        command: |
          ansible-plabook ./infrastructure/init.yml

  Test:
    steps:
      - run:
        name: Run Test Unit
        command: |
          ansible-plabook ./infrastructure/test.yml

  Build:
    steps:
      - run:
        name: Build Artefact
        command: |
          ansible-plabook ./infrastructure/build.yml

  Deploy:
    steps:
      - run:
        name: Deploy Artefact
        command: |
          ansible-plabook ./infrastructure/deploy.yml

  Infra:
    steps:
      - run:
        name: Settings network
        command: |
          ansible-plabook ./infrastructure/network.yml

workflows:
  version: 2
  ci-ci-guihon-front:
    jobs:
      - Init
      - Setup:
          requires:
            - Init
      - Test:
          requires:
            - Setup
      - Build:
          requires:
            - Test
      - Deploy:
          requires:
            - Build
      - Infra:
          requires:
            - Deploy
