version: 2.1

orbs:
  python: circleci/python@3.10.0

jobs:
  Init:
    steps:
      - run:
        name: Install Dependencies
        command: |
          sudo apt update
          apt install python
          pip install ansible

  Setup:
    steps:
    - run:
      name: Config ENV
      command: |
        ansible-playbook ./infrastructure/init.yml

  Test:
    steps:
    - run:
      name: Run Test Unit
      command: |
        ansible-playbook ./infrastructure/test.yml

  Build:
    steps:
    - run:
      name: Build Artefact
      command: |
        ansible-playbook ./infrastructure/build.yml

  Deploy:
    steps:
    - run:
      name: Deploy Artefact
      command: |
        ansible-playbook ./infrastructure/deploy.yml

  Infra:
    steps:
    - run:
      name: Settings network
      command: |
        ansible-playbook ./infrastructure/network.yml

workflows:
  ci-ci-guihon-front:
    jobs:
      - Init
      - Setup
      - Test
      - Build
      - Deploy
      - Infra
